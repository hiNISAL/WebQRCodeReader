<html>
	<head>
		<script src="jsQR.js"></script>
		<script>
			function onFileUpload(event){
				if (event && event.target && event.target.files && event.target.files.length > 0){
					var file = event.target.files[0];
					
					// display image and get image info
					var image = new Image();
					var src = window.URL.createObjectURL(file);
					image.src = src;
					image.onload = function() {
						var imageInfoWidth = document.getElementById("imageInfoWidth");
						var imageInfoHeigth = document.getElementById("imageInfoHeigth");
						var imageDist = document.getElementById("imageDist");
						imageInfoWidth.innerHTML = this.width;
						imageInfoHeigth.innerHTML = this.height;
						imageDist.innerHTML = "";
						
						var canvas = document.createElement('canvas');
						var factor = 1;
						if (this.height > 1000 || this.width > 1000){
							var heightFactor = this.height / 1000;
							var widthFactor = this.height / 1000;
							if (heightFactor > widthFactor ){
								factor= heightFactor ;
							}else{
								factor= widthFactor ;
							}
						}
						var imageInfoResizedWidth = document.getElementById("imageInfoResizedWidth");
						var imageInfoResizedHeigth = document.getElementById("imageInfoResizedHeigth");
						imageInfoResizedWidth.innerHTML = this.width * factor;
						imageInfoResizedHeigth.innerHTML = this.height * factor;
						canvas.height = this.height * factor;
						canvas.width = this.width * factor;
						var ctx = canvas.getContext('2d');
						ctx.drawImage(this, 0, 0);
						var array = ctx.getImageData(0, 0, canvas.width, canvas.height, canvas.width * factor, canvas.height* factor)
						var qr = jsQR(array.data, canvas.width, canvas.height);
						imageDist.appendChild(canvas);
						if (qr && qr.data){
							var qrData = qr.data;
							var qrContent = document.getElementById("qrContent");
							qrContent.innerHTML = qrData;
						}
					};
				}
			}
		</script>
	</head>
	
	
	<body>
		<form>
			<input type="file" onchange="onFileUpload(event)" accept="image/*"/>
			<div>Width:  <span id="imageInfoWidth"></span></div>
			<div>Heigth: <span id="imageInfoHeigth"></span></div>
			<div>Resized Width:  <span id="imageInfoResizedWidth"></span></div>
			<div>Resized Heigth: <span id="imageInfoResizedHeigth"></span></div>
			<div>QR Code Content: <span id="qrContent"></span></div>
			<div id="imageDist">
			</div>
		</form>
	</body>
</html>